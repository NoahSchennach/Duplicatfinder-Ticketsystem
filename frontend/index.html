<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ticket Dashboard</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- ldBar CSS -->
  <link rel="stylesheet" href="loading-bar/dist/loading-bar.min.css">

  <style>
    body, html {
      height: 100%;
      margin: 0;
      background-color: #ffffff;
    }
    .content {
      padding: 2rem;
    }
    .ldBar {
      width: 150px;
      height: 150px;
      margin: 1rem auto;
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar bg-body-tertiary" data-bs-theme="light">    
    <div class="container-fluid">
      <a class="navbar-brand mb-0 h1" href="#">Ticket-Dashboard</a>
      <img src="img/IBF-Logo.svg" width="50" height="40">
    </div>
  </nav>

  <!-- Main Content -->
  <main class="content">
    <h3>Neues Ticket anlegen</h3>

    <!-- Eingabeformular -->
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <form id="ticketForm">
          <div class="input-group input-group-sm mb-3">
            <span class="input-group-text"  id="inputGroup-sizing-sm">Titel</span>
            <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm">
            </div>
          <!--
          <div class="mb-3">
             <label for="ticketText" class="form-label">Ticketbeschreibung</label> -->
            <textarea class="form-control" id="ticketText" rows="3" placeholder="Beschreibe dein Problem..." required></textarea>
          </div>
          <button type="submit" style="background-color:#194f81;" class="btn btn-primary">Ticket pr√ºfen</button>
        </form>
      </div>
    </div>

    <!-- Bereich f√ºr Ergebnisse -->
    <h4>√Ñhnliche Tickets</h4>
    <div class="row" id="resultsContainer">
      <!-- Vergleichsergebnisse kommen hier rein -->
    </div>
  </main>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- ldBar JS -->
  <script src="loading-bar/dist/loading-bar.min.js"></script>

  <script>
    // Funktion: Ergebnis-Karte mit Loading-Bar erstellen
    function renderResult(ticketId, similarity) {
      const container = document.getElementById("resultsContainer");

      const col = document.createElement("div");
      col.className = "col-md-4";

      col.innerHTML = `
        <div class="card text-center shadow-sm">
          <div class="card-body">
            <h6 class="card-title">Ticket #${ticketId}</h6>
            <div id="bar-${ticketId}" class="ldBar label-center" data-preset="circle" data-value="0"></div>
            <p class="mt-2">√Ñhnlichkeit: <strong>${similarity}%</strong></p>
          </div>
        </div>
      `;
      container.appendChild(col);

      const bar = new ldBar(`#bar-${ticketId}`);
      bar.set(similarity);
    }

    // Formular-Submit
    document.getElementById("ticketForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const ticketText = document.getElementById("ticketText").value;

      // Container leeren
      document.getElementById("resultsContainer").innerHTML = "";

      // üîπ Hier sp√§ter: API-Call an dein Backend
      // Beispiel mit fetch():
      /*
      const response = await fetch("/api/compare", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: ticketText })
      });
      const results = await response.json(); // Erwartet [{id:123, similarity:78}, ...]
      */

      // üîπ Testdaten (Dummy), solange Backend fehlt
      const results = [
        { id: 101, similarity: 87 },
        { id: 205, similarity: 65 },
        { id: 309, similarity: 42 }
      ];

      results.forEach(r => renderResult(r.id, r.similarity));

      e.target.reset();
    });
  </script>

</body>
</html>
